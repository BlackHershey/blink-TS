# blink-TS
## Modeling the urge to blink

### Notebooks:  
**Average curves.ipynb**
   * Reads in subject discomfort and effort averages (output of "effort graphs") and creates a single group average curve. Compares the difference in the average and discomfort curves.  
   
**Comparing Models.ipynb**
   * Compared the three generated models (blink-timing, sawtooth and box) to the actual reported discomfort trial for every trial from each subject. Outputs are correlation values and root mean square error.  
   
**Sqrt Change in Discomfort In-between blinks (AVG & SD).ipynb**
   * Takes discomfort from time directly after blink until the time of next blink or trial ends. It plots the difference between the predicted and reported level of discomfort (Î”y = disc(t) - [a(log2(x+c) - log2(t0+c))] - disc(t0)).  Average and standard deviation are also plotted to observe patterns in the change in discomfort directly after a blink. Created separate graphs for the average control group and TS group responses.  
   
**Tic Model - Leading up to First Blink (Just Functions+last graphs).ipynb**
   * Creates multiple different .txt files from blink timing output created by the eye tracking computer program.  Blinks_Time function outputs how much time each subjects spent "in a blink" (with their eyes closed).
   * BlinkList function creates a binary .txt file for each subject to denote if the subject was blinking during the specified time frame (1) or not (0).
   * FirstBlink function identifies the first blink of each suppression trial for each subject.
   * Then there are multiple BeforeFirstBlink functions, for raw and scaled data, and for the control and TS groups, to be separated for analysis. This plots the discomfort (raw or scaled) for each subject leading up to the first blink of each trial (or end of the trial if no blink occurred during the 60 seconds). A moving average function was applied and then sigmoid, square root and log functions were applied to see which most closely represented the reported discomfort. Correlations and root mean square error were reported.

### Scripts/Functions/Libraries:
**Baseline Blinks.py**
   * Creates multiple different .txt files from the \_BaseBlinks output created by the eye tracking computer program (a list of each time frame where in a blink, as well as a binary output of whether the frame was during a blink).
   * Also outputs a "baseline blink rate" to report how much time each subject normally spends blinking at their baseline.  
   
**Effort Graphs.py**
   * Averages all 5 effort trials across each subject to create one average effort curve and one average discomfort curve. Also plotted each effort line and the average line.  
   
**resample_curves_and_average.py**
   * Creates an average discomfort curve for each subject built from all 5 of the subject's discomfort trials. Outputs a .csv file.
   
**avg_model_loocv.py**
   * Creates an average discomfort curve for each subject using only 4 trials, in order to predict what the 1 trial left out may look like (LOOCV analysis). Calculates the correlation of the averaged curve to the reported discomfort of the trial left out and creates a .csv file of these correlations in order to characterize how well the method can predict discomfort.
   
**Resampling Data.py**
   * Resamples the time and discomfort ratings into uniform quarter-second bins and outputs each subject's new resampled ratings and blinks (as a fraction of the bin where eyes were closed) to a new .txt file.  
   
**Z standardized urges.py**
   * Standardizes the reported discomfort using the following formula: (z = (xi - x )/SD). Outputs it as a new .txt file for each subject's standardized discomfort.  

### Effort/Discomfort Rating visual stimulus:
**Java program - Rating12**
  * Displays a number from 0-9 corresponding to the vertical mouse position, which the subject adjusts to reflect current (momentary) effort to suppress blinks or current discomfort. The number is displayed on a square colored red (don't blink) or green (OK to blink). The effort or discomfort rating is saved to disk every 1/4 second (see Participant Data, below).

### Participant Data
Each participant should have the following three files:  

**TM\#\#\#Ratings.txt**
   * The ratings file generated during the discomfort task (discomfort of keeping one's eyes open). Contains all 5 trials of which were being rated simultaneously with blink suppression. 
   * Legend: 
     - time: time in seconds from beginning of 5-trial run
     - block: "OK to blink" or "Don't blink"
     - discomfort: instantaneous rating of discomfort, 0-9, based on vertical mouse position (see "Rating12", above)
     - scaled discomfort: Z-scaled discomfort, i.e. (discomfort - mean discomfort)/SD (see Methods text in manuscript)
   
**TM\#\#\#\_Effort.csv**
   * The ratings file generated by the "effort" task (the effort to keep one's eyes open). Contains all 5 trials of which were being rated simultaneously with blink suppression.  
   * Legend:
     - first column is time in seconds from beginning of 5-trial run. Each run consisted of 60 s "Don't blink" followed by 30 s "OK to blink", repeated 5 times (as did the discomfort runs).
     - second column is instantaneous rating of effort, 0-9, based on vertical mouse position (see "Rating12", above)
   
**TM\#\#\#\_Data.txt**
   * The resulting file after the blink program has been run to identify which frames were in blinks. Identifies the time, what task (don't blink/OK to blink), the RMSE value that, through the use of setting a threshold, identifies the blink, and "false positive" and "false negative" columns. The two "false" columns allowed for a manual correction, *e.g.* if the video was compromised by movement of the eyes or change in lighting.
   * Legend:
     - time lined up: time in seconds from start of task
     - block: indicates "OK to blink" or "Don't blink" phase of task
     - rmse: root-mean-square error (see Methods in manuscript) of a square piece of video input centered on the eye, versus the comparison frame with the eye open. Closing the eyelids raises this value.
     - false positive: 0 by default. 1 manually entered if the threshold suggested a blink where one in fact did not occur (based on human review of the video)
     - false negative: 0 by default. 1 manually entered if the threshold did not catch a blink where one in fact occurred (based on human review of the video)
